---
const today = new Date();
import contactIconRaw from "../../assets/icons/contact-icon.svg?raw";
import Button from "../ui/button/Button.astro";

function sanitizeToWhite(svg: string, size = 18) {
  let s = svg
    .replace(/<\?xml[\s\S]*?\?>/g, "")
    .replace(/<!--([\s\S]*?)-->/g, "")
    .replace(/width=\"[^\"]*\"/g, "")
    .replace(/height=\"[^\"]*\"/g, "")
    // Ensure shapes are visible: use white via currentColor on fill, drop strokes
    .replace(/fill=\"[^\"]*\"/gi, 'fill="currentColor"')
    .replace(/stroke=\"[^\"]*\"/gi, 'stroke="none"');
  s = s.replace(/<svg([^>]*)>/, (m, attrs) => `<svg${attrs} width="${size}" height="${size}">`);
  return s;
}

const contactIcon = sanitizeToWhite(contactIconRaw);
const feedUrl = new URL('rss.xml', Astro.site).toString();
const feedlyUrl = `https://feedly.com/i/subscription/feed/${feedUrl}`;
const inoreaderUrl = `https://www.inoreader.com/?add_feed=${feedUrl}`;
---

<footer id="contact" class="py-12 px-4 text-center">
  <h2 class="text-2xl md:text-3xl font-semibold text-foreground">Want to work with me?</h2>
  <p class="mt-2 text-[color:var(--color-text-muted)]">Let's build something together!</p>
  <div class="mt-6 flex justify-center">
    <Button href="https://www.linkedin.com/in/guihubie/" variant="secondary" size="md" >
      <span class="inline-flex" aria-hidden="true" set:html={contactIcon} />
      Hubungi Segera
    </Button>
  </div>
  <div class="mt-6 text-sm text-[color:var(--color-text-muted)]">Made by: <a href="https://studikelayakan.netlify.app/" class="hover:text-[color:var(--accent)]">Konsultan</a>.</div>
  <div class="mt-6 flex items-center justify-center gap-4 text-sm">
    <a class="sw-btn-sm" href={feedlyUrl} target="_blank" rel="noopener noreferrer" aria-label="Subscribe in Feedly">Feedly</a>
    <a class="sw-btn-sm" href={inoreaderUrl} target="_blank" rel="noopener noreferrer" aria-label="Subscribe in Inoreader">Inoreader</a>
    <button class="sw-btn-sm" type="button" data-copy={feedUrl} aria-label="Copy RSS link">Copy RSS link</button>
    <a class="sw-btn-sm" href="/blog/" aria-label="Browse all posts">All posts</a>
  </div>
  <script type="module">
    document.addEventListener('click', (e) => {
      const target = e.target;
      if (!(target instanceof HTMLElement)) return;
      if (target.matches('button[data-copy]')) {
        const url = target.getAttribute('data-copy');
        if (!url) return;
        navigator.clipboard?.writeText(url);
        const original = target.textContent || 'Copy RSS link';
        target.textContent = 'Copied!';
        setTimeout(() => { target.textContent = original; }, 1500);
      }
    });
  </script>
</footer>
